@startuml
skinparam sequenceMessageAlign center
autoactivate on

actor "User" as User
participant "AddBookScreen" as Screen
participant "Actions" as Action
participant "LibraryService" as Service
participant "API" as API
participant "Reducer" as Store

note right of User
  User is on AddBookScreen
  (Book details are already loaded)
end note

User -> Screen : Enter Stock & Click "Confirm and Add"
note right of Screen
  Validates input
  (Stock must be integer >= 0)
end note

Screen -> Action : addBookAction(dispatch, libId, isbn, { stock })

Action -> Store : dispatch({ type: SET_LOADING, payload: true })
return State Updated (isLoading = true)

Action -> Service : AddNewBook(libId, isbn, { stock })
Service -> API : POST /v1/library/{id}/book/{isbn}
return 200 OK (Success)

note right of Action
  **Refetch Pattern:**
  Reloads books to include
  the newly added book
end note

Action -> Action : fetchBooksAction(dispatch, libId)
    Action -> Service : GetBooks(libId)
    Service -> API : GET /v1/library/{id}/book
    return List of Books

    Action -> Store : dispatch({ type: FETCH_BOOKS_SUCCESS, list })
    return State Updated
return Refetch Complete

return Promise Resolved

Screen -> User : Alert("Success", "Book added successfully")
User -> Screen : Click "OK"

Screen -> Screen : navigation.navigate("LibraryBooks", { libraryId })
return Navigate to Book List

@enduml